Причина ошибки:
Формат "%[^n]" в scanf означает "читать все символы, кроме буквы 'n', а не символа новой строки '\n'. 
После ввода числа и нажатия Enter в буфере остаётся символ '\n', который не является буквой 'n', 
поэтому scanf("%[^n]", str) пытается его прочитать, что иногда приводит к некорректному поведению, 
поскольку символ '\n' не обрабатывается должным образом в этом контексте.

Способ исправления:
Заменить "%[^n]" на "%[^\n]" — это позволит читать строку до символа новой строки '\n'.
Также необходимо очистить буфер от предыдущего символа '\n' перед чтением строки, 
например, с помощью getchar() или цикла while (getchar() != '\n').